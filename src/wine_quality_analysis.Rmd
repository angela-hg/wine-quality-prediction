---
title: "Wine Quality Prediction"
author: "Angela Herrera"
output: github_document
---

# Introduction

This analysis explores whether wine chemical composition can predict quality ratings.  
Using red and white *Vinho Verde* datasets, we train and compare several models.

```{r setup, message=FALSE, warning=FALSE}
# Load libraries
library(caret)
library(ggplot2)
library(corrplot)
library(GGally)
library(glmnet)
library(randomForest)
library(nnet)
library(rpart)
```

# 1. Data Loading

```{r data_load, message=FALSE, warning=FALSE}
red <- read.csv("../data/winequality-red.csv", sep = ";")
white <- read.csv("../data/winequality-white.csv", sep = ";")

red$Type <- "Red"
white$Type <- "White"

wine_data <- rbind(red, white)
wine_data$Type <- as.factor(wine_data$Type)

summary(wine_data)
```

# 2. Exploratory Data Analysis

```{r num_vars, message=FALSE, warning=FALSE}
numeric_vars <- wine_data[, sapply(wine_data, is.numeric)]
corr_matrix <- cor(numeric_vars)
corrplot(corr_matrix, method = "color", type = "upper", tl.col = "black", tl.srt = 45)
```

```{r boxplot, message=FALSE, warning=FALSE}
boxplot(wine_data$quality ~ wine_data$Type,
        main = "Wine Quality by Type",
        xlab = "Type", ylab = "Quality", col = c("red", "white"))
```

# 3. Train-Test Split

```{r tt_split, message=FALSE, warning=FALSE}
set.seed(123)
train_index <- createDataPartition(wine_data$quality, p = 0.8, list = FALSE)
train <- wine_data[train_index, ]
test  <- wine_data[-train_index, ]
ctrl <- trainControl(method = "cv", number = 5)
```

# 4. Model Training

```{r model_training, message=FALSE, warning=FALSE}

# Ridge Regression
ridge <- train(quality ~ ., data = train, method = "glmnet",
               trControl = ctrl,
               tuneGrid = expand.grid(alpha = 0, lambda = seq(0.01, 0.1, 0.01)))

# Lasso Regression
lasso <- train(quality ~ ., data = train, method = "glmnet",
               trControl = ctrl,
               tuneGrid = expand.grid(alpha = 1, lambda = seq(0.01, 0.1, 0.01)))

# Elastic Net
elastic <- train(quality ~ ., data = train, method = "glmnet", trControl = ctrl, tuneLength = 5)

# CART
cart <- train(quality ~ ., data = train, method = "rpart", trControl = ctrl, tuneLength = 5)

# Random Forest
rf <- train(quality ~ ., data = train, method = "rf", trControl = ctrl, tuneLength = 3)

# Neural Network
nn <- train(quality ~ ., data = train, method = "nnet", trControl = ctrl,
            linout = TRUE, trace = FALSE, tuneLength = 5)

```


# 5. Model Evaluation

```{r evaluation, message=FALSE, warning=FALSE}

results <- list(
  Ridge = postResample(predict(ridge, test), test$quality),
  Lasso = postResample(predict(lasso, test), test$quality),
  ElasticNet = postResample(predict(elastic, test), test$quality),
  CART = postResample(predict(cart, test), test$quality),
  RandomForest = postResample(predict(rf, test), test$quality),
  NeuralNet = postResample(predict(nn, test), test$quality)
)

results_df <- data.frame(
  Model = names(results),
  RMSE = sapply(results, "[[", "RMSE"),
  Rsquared = sapply(results, "[[", "Rsquared"),
  MAE = sapply(results, "[[", "MAE")
)

results_df

```

# 6. Model Comparison

```{r mod_comp, message=FALSE, warning=FALSE}
model_list <- list(Ridge=ridge, Lasso=lasso, ElasticNet=elastic,
                   CART=cart, RandomForest=rf, NeuralNet=nn)
resamp <- resamples(model_list)

bwplot(resamp, metric = "RMSE", main = "Model RMSE Comparison")
dotplot(resamp, metric = "Rsquared", main = "Model R2 Comparison")
```

# Conclusion

The Random Forest model achieved the best predictive accuracy, with an RMSE of ~0.61 and R2 of ~0.54.
This suggests that wine quality can be moderately predicted using chemical composition data.
Future work could involve testing deep learning or separate models for red and white wines.

